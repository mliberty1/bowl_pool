{% extends "base.html" %}

{% block title %}Admin: Manage Participants - Bowl Pool{% endblock %}

{% block content %}
<h1>Admin: Manage Participants</h1>

<p><a href="{{ url_for('scoreboard') }}">&larr; Back to Scoreboard</a></p>

{% if editing_participant %}
<div class="card" style="border: 2px solid #3498db;">
    <h2>Edit Participant</h2>
    <form method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <input type="hidden" name="action" value="edit">
        <input type="hidden" name="participant_id" value="{{ editing_participant.id }}">

        <div class="form-group">
            <label for="edit_name">Full Name:</label>
            <input type="text" id="edit_name" name="name" value="{{ editing_participant.name }}" required>
        </div>

        <div class="form-group">
            <label for="edit_nickname">Nickname (optional):</label>
            <input type="text" id="edit_nickname" name="nickname" value="{{ editing_participant.nickname or '' }}">
        </div>

        <div class="form-group">
            <label for="edit_email">Email (optional):</label>
            <input type="email" id="edit_email" name="email" value="{{ editing_participant.email or '' }}">
        </div>

        <div class="form-group">
            <label>
                <input type="checkbox" name="is_admin" {% if editing_participant.is_admin %}checked{% endif %}>
                Admin privileges
            </label>
        </div>

        <button type="submit" class="btn btn-success">Save Changes</button>
        <a href="{{ url_for('admin_participants') }}" class="btn">Cancel</a>
    </form>
</div>
{% endif %}

<div class="card">
    <h2>Add New Participant</h2>
    <form method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <input type="hidden" name="action" value="add">

        <div class="form-group">
            <label for="name">Full Name:</label>
            <input type="text" id="name" name="name" required>
        </div>

        <div class="form-group">
            <label for="nickname">Nickname (optional):</label>
            <input type="text" id="nickname" name="nickname">
        </div>

        <div class="form-group">
            <label for="email">Email (optional):</label>
            <input type="email" id="email" name="email">
        </div>

        <div class="form-group">
            <label>
                <input type="checkbox" name="is_admin">
                Admin privileges
            </label>
        </div>

        <button type="submit" class="btn btn-success">Add Participant</button>
    </form>
</div>

<div class="card">
    <h2>Existing Participants</h2>
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Nickname</th>
                <th>Email</th>
                <th>Admin</th>
                <th>Invite Token</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for participant in participants %}
            <tr>
                <td>{{ participant.name }}</td>
                <td>{{ participant.nickname or '-' }}</td>
                <td>{{ participant.email or '-' }}</td>
                <td>{{ 'Yes' if participant.is_admin else 'No' }}</td>
                <td>
                    {% set login_url = url_for('login', token=participant.invite_token, _external=True) %}
                    <strong>Login URL:</strong><br>
                    <input type="text" value="{{ login_url }}" readonly
                           style="width: 100%; font-family: monospace; font-size: 0.85em; margin-top: 5px;"
                           onclick="this.select()">
                    <br>
                    <a href="{{ login_url }}" target="_blank" class="btn" style="margin-top: 5px; font-size: 0.85em;">
                        Test Login Link
                    </a>
                </td>
                <td>
                    <a href="{{ url_for('admin_participants', edit=participant.id) }}" class="btn">Edit</a>
                    <form method="POST" style="display: inline;" onsubmit="return confirm('Delete {{ participant.name }}?');">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <input type="hidden" name="action" value="delete">
                        <input type="hidden" name="participant_id" value="{{ participant.id }}">
                        <button type="submit" class="btn btn-danger">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
